 
-- 基本品号信息 
SELECT DISTINCT MOCTA.TA003 开单日期, RTRIM(PURMA.MA001) 供应商编号, RTRIM(INVMB.MB001) 品号, RTRIM(INVMB.MB002) 品名, RTRIM(INVMB.MB003) 规格, 
RTRIM(INVMB.MB004) 单位, CAST(INVMC.MC004 AS FLOAT) 安全库存, CAST(INVMC.MC007 AS FLOAT) 库存数量
FROM MOCTA(NOLOCK) 
INNER JOIN MOCTB(NOLOCK) ON MOCTA.TA001 = MOCTB.TB001 AND MOCTA.TA002 = MOCTB.TB002 
INNER JOIN INVMB(NOLOCK) ON INVMB.MB001 = MOCTB.TB003 
INNER JOIN INVMC(NOLOCK) ON INVMB.MB001 = INVMC.MC001 AND INVMC.MC002 = INVMB.MB017 
LEFT JOIN PURMA(NOLOCK) ON PURMA.MA001 = INVMB.MB032 
WHERE 1=1 
AND MOCTA.TA003 BETWEEN '20201001' AND '20201031' 
AND INVMB.MB025 = 'P' AND INVMB.MB034 = 'R' 
GROUP BY MOCTA.TA003, RTRIM(PURMA.MA001), RTRIM(PURMA.MA002), RTRIM(INVMB.MB001), RTRIM(INVMB.MB002), RTRIM(INVMB.MB003), RTRIM(INVMB.MB004), 
	CAST(INVMC.MC004 AS FLOAT), CAST(INVMC.MC007 AS FLOAT) 
ORDER BY RTRIM(INVMB.MB001)


-- 每天
SELECT MOCTA.TA003 开单日期, RTRIM(PURMA.MA001) 供应商编号, RTRIM(PURMA.MA002) 供应商, RTRIM(INVMB.MB001) 品号, RTRIM(INVMB.MB002) 品名, RTRIM(INVMB.MB003) 规格, 
RTRIM(INVMB.MB004) 单位, CAST(INVMC.MC004 AS FLOAT) 安全库存, CAST(INVMC.MC007 AS FLOAT) 库存数量, 
CAST(SUM(MOCTB.TB004) AS FLOAT) 需领数量
FROM MOCTA(NOLOCK) 
INNER JOIN MOCTB(NOLOCK) ON MOCTA.TA001 = MOCTB.TB001 AND MOCTA.TA002 = MOCTB.TB002 
INNER JOIN INVMB(NOLOCK) ON INVMB.MB001 = MOCTB.TB003 
INNER JOIN INVMC(NOLOCK) ON INVMB.MB001 = INVMC.MC001 AND INVMC.MC002 = INVMB.MB017 
LEFT JOIN PURMA(NOLOCK) ON PURMA.MA001 = INVMB.MB032 
WHERE 1=1 
AND MOCTA.TA003 BETWEEN '20201001' AND '20201031' 
AND INVMB.MB025 = 'P' AND INVMB.MB034 = 'R' 
GROUP BY MOCTA.TA003, RTRIM(PURMA.MA001), RTRIM(PURMA.MA002), RTRIM(INVMB.MB001), RTRIM(INVMB.MB002), RTRIM(INVMB.MB003), RTRIM(INVMB.MB004), 
	CAST(INVMC.MC004 AS FLOAT), CAST(INVMC.MC007 AS FLOAT) 
ORDER BY RTRIM(INVMB.MB001)


-- 每月
SELECT LEFT(MOCTA.TA003, 6) 开单日期, RTRIM(PURMA.MA001) 供应商编号, RTRIM(PURMA.MA002) 供应商, RTRIM(INVMB.MB001) 品号, RTRIM(INVMB.MB002) 品名, RTRIM(INVMB.MB003) 规格, 
RTRIM(INVMB.MB004) 单位, CAST(INVMC.MC004 AS FLOAT) 安全库存, CAST(INVMC.MC007 AS FLOAT) 库存数量, 
CAST(SUM(MOCTB.TB004) AS FLOAT) 需领数量
FROM MOCTA(NOLOCK) 
INNER JOIN MOCTB(NOLOCK) ON MOCTA.TA001 = MOCTB.TB001 AND MOCTA.TA002 = MOCTB.TB002 
INNER JOIN INVMB(NOLOCK) ON INVMB.MB001 = MOCTB.TB003 
INNER JOIN INVMC(NOLOCK) ON INVMB.MB001 = INVMC.MC001 AND INVMC.MC002 = INVMB.MB017 
LEFT JOIN PURMA(NOLOCK) ON PURMA.MA001 = INVMB.MB032 
WHERE 1=1 
AND MOCTA.TA003 BETWEEN '20200801' AND '20201031' 
AND INVMB.MB025 = 'P' AND INVMB.MB034 = 'R' 
GROUP BY LEFT(MOCTA.TA003, 6), RTRIM(PURMA.MA001), RTRIM(PURMA.MA002), RTRIM(INVMB.MB001), RTRIM(INVMB.MB002), RTRIM(INVMB.MB003), RTRIM(INVMB.MB004), 
	CAST(INVMC.MC004 AS FLOAT), CAST(INVMC.MC007 AS FLOAT) 
ORDER BY RTRIM(INVMB.MB001)


