USE COMFORT  
--请购单与采购单对比
SELECT TB001 请购单别, TB002 请购单号, TB003 请购序号, TB004 请购品号, TD001 采购单别, TD002 请购单号, TD004 请购品号, MB002 品号名称, MB032 主供应商, INVMB.UDF06 次供应商, PURTD.CREATOR FROM PURTB
LEFT JOIN PURTD ON TB001 = TD026 AND TB002 = TD027 AND TB004 = TD004
LEFT JOIN INVMB ON TB004 = MB001
WHERE TB001 = '3101'
AND TB002 = '18050101'


--请购单中同一品号订单数统计
--避免因为订单数大于36导致自动生成采购单失败
SELECT TB010 供应商, TB004 品号, COUNT(A) 订单数 FROM 
(SELECT TB010, TB004, COUNT(TB030) A
FROM PURTB
WHERE TB001 = '3101'
AND TB002 = '18050106'
GROUP BY TB010, TB030, TB004) B
GROUP BY TB010, TB004 HAVING COUNT(A) > 36
ORDER BY TB010, TB004
