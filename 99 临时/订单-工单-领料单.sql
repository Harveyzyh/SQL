--订单查询，生产计划，工单，领料单

USE COMFORT

SELECT DISTINCT 
TD001 订单别, TD002 订单号, TD003 订单序, 

TA001 工单别, TA002 工单号, 
TE001 领料单别, TE002 领料单号, 
TC019 领料来源别, TC020 领料来源号 
FROM COPTD
LEFT JOIN MOCTA ON TA026 = TD001 AND TA027 = TD002 AND TA028 = TD003
LEFT JOIN MOCTE ON TE011 = TA001 AND TE012 = TA002
LEFT JOIN MOCTC ON TC019 = TE001 AND TC020 = TE002
WHERE 1=1 
AND RTRIM(TD001) + '-' + RTRIM(TD002) + '-' + RTRIM(TD003) = '2215-0018-0001'     --订单信息
--AND RTRIM(TA001) + '-' + RTRIM(TA002) = '5101-18061471' --工单信息
--AND RTRIM(TE001) + '-' + RTRIM(TE002) = '5406-2018061791'


--订单查询，采购计划，请购单，采购单
SELECT DISTINCT 
COPTD.TD001 订单别, COPTD.TD002 订单号, COPTD.TD003 订单序, 
TC001 采购计划号,
TB001 请购单别, TB002 请购单号, 
PURTD.TD001 采购单别, PURTD.TD002 采购单号
FROM COPTD 
LEFT JOIN MOCTA ON TA026 = COPTD.TD001 AND TA027 = COPTD.TD002 AND TA028 = COPTD.TD003
LEFT JOIN LRPTC ON TC026 = TD001 AND TC027 = TD002 AND TC028 = TD003
LEFT JOIN PURTB ON TB029 = TD001 AND TB030 = TD002 AND TB031 = TD003
LEFT JOIN PURTD ON PURTD.TD026 = TB001 AND PURTD.TD027 = TB002 
WHERE 1=1 
AND RTRIM(COPTD.TD001) + '-' + RTRIM(COPTD.TD002) + '-' + RTRIM(COPTD.TD003) = '2215-0018-0001'    --订单信息
--AND RTRIM(TA001) + '-' + RTRIM(TA002) = '5101-18061471' --工单信息
--AND RTRIM(TE001) + '-' + RTRIM(TE002) = '5406-2018061791'


--二次领料，三次领料
SELECT TB001, TB002, TE.TE004, TE.TE005, TE.TE001, TE.TE002, TETE.TE001, TETE.TE002 FROM MOCTE AS TE
LEFT JOIN MOCTB ON TB001 = TE011 AND TB002 = TE012 AND TE004 = TB003
LEFT JOIN MOCTC AS TCTC ON TCTC.TC019 = TE.TE001 AND TCTC.TC020 = TE.TE002
LEFT JOIN MOCTE AS TETE ON TETE.TE001 = TCTC.TC001 AND TETE.TE002 = TCTC.TC002 AND TETE.TE004 = TE.TE004
WHERE TE.TE001 = '5406' AND TE.TE002 = '2018062119'

