-- BOM信息异常检测
SELECT CA1.CREATOR BOM创建人, CA1.CREATE_DATE BOM创建时间, 
MB1.MB001 主件品号, MB1.MB002 主件品名, MB1.MB003 主件规格, MB1.MB025 品号属性, MB1.MB109 核准状况, 
(CASE MB1.MB443 WHEN '0' THEN '无' WHEN '1' THEN '单阶选配' WHEN '2' THEN '多阶选配' ELSE MB1.MB443 END) 选配模式, 
(CASE CA1.CA013 WHEN '1' THEN '必选唯一' WHEN '2' THEN '至少选一个' WHEN '3' THEN '可选唯一' WHEN '4' THEN '任意选' ELSE CA1.CA013 END) 子间关系, CA1.CA017 BOM审核码, 
CB1.CB004 子件序号, CB1.CB005 子件品号, MB2.MB002 子件品名, MB2.MB003 子件规格, CB1.CB013 生效日期, CB1.CB014 失效日期, CB1.CB015 默认选择, IFNULL(CB2.COUNTCB005, 0) 默认选择Y计数
FROM INVMB AS MB1
LEFT JOIN BOMCA AS CA1 ON CA1.CA003 = MB1.MB001
INNER JOIN BOMCB AS CB1 ON CA1.CA003 = CB1.CB001
INNER JOIN INVMB AS MB2 ON CB1.CB005 = MB2.MB001
LEFT JOIN 
(
	SELECT CB001 COUNTCB001, COUNT(CB005) COUNTCB005 FROM BOMCB
	WHERE CB015 = 'Y'
	GROUP BY CB001
) AS CB2 ON CB2.COUNTCB001 = MB1.MB001
WHERE 1=1
AND MB1.MB025 = 'C' AND MB1.MB109 = 'Y'
AND CA1.CA013 = '1'

ORDER BY MB1.MB001, CB004

-- 品号信息主次供应商
SELECT MB001 品号, MB025, MB109, MB032, MB200 FROM INVMB WHERE (MB032 = 'A0106' OR MB200 = 'A0106') AND MB032 != MB200

-- BOM单阶信息查找
SELECT RTRIM(CB005) 品号, CAST(CB008 AS FLOAT)/CAST(CB009 AS FLOAT) 用量, MB025 品号属性, CB011 工艺 , CB015
FROM BOMCB 
INNER JOIN INVMB  ON MB001= CB005 
WHERE 1=1 
AND MB109 = 'Y' 
AND (CB013 <= CONVERT(VARCHAR(20), GETDATE(), 112) OR CB013 IS NULL OR RTRIM(CB013) = '')
AND (CB014 > CONVERT(VARCHAR(20), GETDATE(), 112) OR CB014 IS NULL OR RTRIM(CB014) = '')
AND CB001 = '25001052' 
-- AND CB015 = 'Y'
ORDER BY CB004

