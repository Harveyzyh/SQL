SELECT * 
-- UPDATE PURTG SET TG016 = TG016 + '，原税率为' + CONVERT(VARCHAR(20), TG030) + '更改为0.13（20190701）', TG030 = 0.13
FROM PURTG
WHERE TG001 = '3401' AND TG002 IN ('19034892')

SELECT * FROM PURTH 
WHERE TH001 = '3401' AND TH002 IN ('19034892')


-- 修改退货单
SELECT TI001, TI002, TI027, TG001, TG002, TG030, TC001, TC002, TC026, TD033, TD008 采购数量, TD015 已交数量, TJ009 退货数量
-- UPDATE PURTI SET TI027 = 0.13
-- UPDATE PURTG SET TG030 = 0.13
-- UPDATE PURTC SET TC026 = 0.13
-- UPDATE PURTD SET TD033 = 0.13
FROM PURTI
INNER JOIN PURTJ ON TJ001 = TI001 AND TJ002 = TI002
INNER JOIN PURTG ON TJ013 = TG001 AND TJ014 = TG002
INNER JOIN PURTH ON TH001 = TJ013 AND TH002 = TJ014 AND TH003 = TJ015
INNER JOIN PURTC ON TJ016 = TC001 AND TJ017 = TC002
INNER JOIN PURTD ON TJ016 = TD001 AND TJ017 = TD002 AND TJ018 = TD003

WHERE 1=1
AND TI001 = '3501' AND TI002 = '19090055'


-- 修改进货单， 包含采购单指定结束
SELECT TG001, TG002, TG030, TC001, TC002, TC026, TD033, TD016, TD004
-- UPDATE PURTG SET TG030 = 0
-- UPDATE PURTC SET TC026 = 0
-- UPDATE PURTD SET TD033 = 0
-- UPDATE PURTD SET TD016 = 'N'  -- 指定结束
-- UPDATE PURTD SET TD016 = 'y'  -- 指定结束
FROM PURTG 
INNER JOIN PURTH ON TH001 = TG001 AND TH002 = TG002 
INNER JOIN PURTD ON TH011 = TD001 AND TH012 = TD002 AND TH013 = TD003
INNER JOIN PURTC ON TD001 = TC001 AND TD002 = TC002

WHERE 1=1
AND TG001 = '3401' -- AND TG002 IN ('19070046', '19070047', '19070048', '19070049')
AND TG002 = '19100269'
-- AND TD004 = '3050304007' AND TC002 = '19084011'
-- AND TD016 = 'y'
ORDER BY TG002


-- 修改采购单单身指定结束标志位
SELECT TC001, TC002, TD004, TD016 
-- UPDATE PURTD SET TD016 = 'y'
FROM PURTC
INNER JOIN PURTD ON TC001 = TD001 AND TC002 = TD002
WHERE TC001 = '3308' AND TC002 = '18030226'
-- AND TD016 = 'y'
AND TD004 IN ('3030402034')


-- 修改退货单中的进货单信息
SELECT *
-- UPDATE PURTJ SET TJ014 = '19070048'
FROM PURTJ WHERE TJ001 = '3501' AND TJ002 = '19070010' AND TJ003 IN ('0044', '0043', '0042')

