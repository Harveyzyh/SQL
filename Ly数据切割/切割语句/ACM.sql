--ACM 高级成本系统----(执行完切割工单模块[MOC]后执行)

--工单成本分配依据

SELECT * FROM ACMTC WHERE TC005+TC006 NOT IN (SELECT TA001+TA002 FROM MOCTA) AND TC001<='201612'
    
DELETE ACMTC FROM ACMTC 
LEFT JOIN MOCTA ON TC005=TA001 AND TC006=TA002
WHERE TC005+TC006 NOT IN (SELECT TA001+TA002 FROM MOCTA) AND TC001<='201612'

--DELETE ACMTD FROM ACMTD
--LEFT JOIN MOCTA ON TD005=TA001 AND  TD006=TA002
--WHERE TD005+TD006 NOT IN (SELECT TA001+TA002 FROM MOCTA)

DELETE FROM ACMTD WHERE TD001+TD002+TD003+TD004+TD005+TD006+TD007+TD008+TD009+TD010 
NOT IN (SELECT TC001+TC002+TC003+TC004+TC005+TC006+TC007+TC008+TC009+TC010 FROM ACMTC)
								 
--部门成本分配率
 
DELETE ACMTE WHERE TE001<='201612'	

DELETE ACMTF WHERE TF001<='201612'


--成本计算

SELECT * FROM ACMTI WHERE TI006+TI007 NOT IN (SELECT TA001+TA002 FROM MOCTA) AND TI003<='201612'

DELETE ACMTI FROM ACMTI
LEFT JOIN MOCTA ON TI006=TA001 AND TI007=TA002 
WHERE TI006+TI007 NOT IN (SELECT TA001+TA002 FROM MOCTA)
AND TI003<='201612'
					
SELECT * FROM ACMTJ WHERE TJ001+TJ002 NOT IN (SELECT TI001+TI002 FROM ACMTI) AND TJ026<='201612'

--DELETE ACMTJ FROM ACMTJ
--LEFT JOIN ACMTI ON TI001=TJ001 AND TI002=TJ002
--WHERE TJ001+TJ002 NOT IN (SELECT TI001+TI002 FROM ACMTI)
--AND TJ026<='201612'

DELETE FROM ACMTJ WHERE TJ001+TJ002 NOT IN (SELECT TI001+TI002 FROM ACMTI) AND TJ026<='201612'


--成本计算单身工单明细档

SELECT * FROM ACMTK WHERE TK001+TK002+TK003+TK004+TK005+TK006+TK007  
NOT IN (SELECT TI001+TI002+TI003+TI004+TI005+TI006+TI007 FROM ACMTI)

DELETE FROM ACMTK WHERE TK001+TK002+TK003+TK004+TK005+TK006+TK007  
NOT IN (SELECT TI001+TI002+TI003+TI004+TI005+TI006+TI007 FROM ACMTI)

--产品成本

SELECT * FROM ACMTL WHERE  TL001<='201612'
DELETE ACMTL FROM ACMTL WHERE TL001<='201612'

SELECT * FROM ACMTM WHERE TM001+TM002+TM003 NOT IN (SELECT TL001+TL002+TL003 FROM ACMTL)
DELETE FROM ACMTM WHERE TM001+TM002+TM003 NOT IN (SELECT TL001+TL002+TL003 FROM ACMTL)

---完工率

SELECT * FROM ACMTN WHERE TN004+TN005 NOT IN (SELECT TA001+TA002 FROM MOCTA) AND TN001<='201612'
    
DELETE ACMTN FROM ACMTN 
LEFT JOIN MOCTA ON TN004=TA001 AND TN005=TA002
WHERE TN004+TN005 NOT IN (SELECT TA001+TA002 FROM MOCTA) AND TN001<='201612'

SELECT * FROM ACMTO WHERE TO001+TO002+TO003+TO004+TO005 NOT IN (SELECT TN001+TN002+TN003+TN004+TN005 FROM ACMTN)


--成本计算单部门成本明细

SELECT * FROM ACMTP WHERE TP001+TP002+TP007 NOT IN (SELECT TJ001+TJ002+TJ003 FROM ACMTJ) AND TP003<='201612'

DELETE  FROM ACMTP WHERE TP001+TP002+TP007 NOT IN (SELECT TJ001+TJ002+TJ003 FROM ACMTJ) AND TP003<='201612'

--成本计算单产出数量明细

SELECT * FROM ACMTQ WHERE TQ001+TQ002 NOT IN (SELECT TJ001+TJ002 FROM ACMTJ) 
AND TQ006+TQ007 NOT IN (SELECT TA001+TA002 FROM MOCTA) AND TQ003<='201612'

DELETE ACMTQ WHERE TQ001+TQ002 NOT IN (SELECT TJ001+TJ002 FROM ACMTJ) 
AND TQ006+TQ007 NOT IN (SELECT TA001+TA002 FROM MOCTA) AND TQ003<='201612'

 
 --ACMLC成本年月低阶码档 
   
DELETE ACMLC WHERE LC001<='201612'
