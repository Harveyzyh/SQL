-----PUR采购管理子系统------


---请购单（单身未结束保留）

SELECT * FROM PURTB 
LEFT JOIN PURTA ON TA001=TB001 AND TA002=TB002 
WHERE TA003<='20161231'  AND TB039<>'N' --AND TB029+TB030+TB031 NOT IN (SELECT TD001+TD002+TD003 FROM COPTD)

DELETE FROM PURTB WHERE TB001+TB002+TB003 IN 
(SELECT TB001+TB002+TB003 FROM PURTB 
LEFT JOIN PURTA ON TA001=TB001 AND TA002=TB002 
WHERE TA003<='20161231'  AND TB039<>'N') --AND TB029+TB030+TB031 NOT IN (SELECT TD001+TD002+TD003 FROM COPTD))

DELETE  FROM PURTA WHERE TA001+TA002 NOT IN (SELECT TB001+TB002 FROM PURTB)

DELETE  FROM PURTR WHERE TR001+TR002+TR003 NOT IN (SELECT TB001+TB002+TB003 FROM PURTB)

---采购单

SELECT TD001+TD002+TD003 FROM PURTD 
LEFT JOIN PURTC ON TC001=TD001 AND TC002=TD002 
WHERE TC003<='20161231'  AND TD016<>'N' --AND TD013+TD021+TD023 NOT IN (SELECT TD001+TD002+TD003 FROM COPTD)

DELETE FROM PURTD WHERE TD001+TD002+TD003 IN 
(SELECT TD001+TD002+TD003 FROM PURTD 
LEFT JOIN PURTC ON TC001=TD001 AND TC002=TD002 
WHERE TC003<='20161231'  AND TD016<>'N') --AND TD013+TD021+TD023 NOT IN (SELECT TD001+TD002+TD003 FROM COPTD))

DELETE FROM PURTC WHERE TC001+TC002 NOT IN (SELECT TD001+TD002 FROM PURTD)
------------------------------------------------------------------------------------

---采购变更单

SELECT * FROM PURTE WHERE TE001+TE002 NOT IN (SELECT TC001+TC002 FROM PURTC)

DELETE  FROM PURTE WHERE TE001+TE002 NOT IN (SELECT TC001+TC002 FROM PURTC)

DELETE FROM PURTF WHERE TF001+TF002 NOT IN (SELECT TE001+TE002 FROM PURTE)

---到货单

SELECT * FROM PURCD WHERE CD010+CD011+CD012 NOT IN (SELECT TD001+TD002+TD003 FROM PURTD)

DELETE FROM PURCD WHERE CD010+CD011+CD012 NOT IN (SELECT TD001+TD002+TD003 FROM PURTD)

DELETE FROM PURCC WHERE CC001+CC002 NOT IN (SELECT CD001+CD002 FROM PURCD)


---进货单

SELECT TH001+TH002+TH003 FROM PURTH 
LEFT JOIN PURTG ON TG001=TH001 AND TG002=TH002 
WHERE TG003<='20161231' AND TH031='Y'--开票  
AND TH011+TH012+TH013 NOT IN (SELECT TD001+TD002+TD003 FROM PURTD)--是否存在不核对采购

DELETE FROM PURTH WHERE TH001+TH002+TH003 IN 
(SELECT TH001+TH002+TH003 FROM PURTH 
LEFT JOIN PURTG ON TG001=TH001 AND TG002=TH002 
WHERE TG003<='20161231' AND TH031='Y'
AND TH011+TH012+TH013 NOT IN (SELECT TD001+TD002+TD003 FROM PURTD))--是否存在不核对采购

DELETE FROM PURTG WHERE TG001+TG002 NOT IN (SELECT TH001+TH002 FROM PURTH)

DELETE FROM PURTK WHERE TK002+TK003+TK004 NOT IN (SELECT TH001+TH002+TH003 FROM PURTH)

-------------------------------------------------------------------------------------------------------------------

---退货单

SELECT TJ001+TJ002+TJ003 FROM PURTJ 
LEFT JOIN PURTI ON TI001=TJ001 AND TI002=TJ002 
WHERE TI003<='20161231' AND TJ021='Y' 
AND TJ013+TJ014+TJ015 NOT IN (SELECT TH001+TH002+TH003 FROM PURTH )--是否存在不核对采购

DELETE FROM PURTJ WHERE TJ001+TJ002+TJ003 IN 
(SELECT TJ001+TJ002+TJ003 FROM PURTJ 
LEFT JOIN PURTI ON TI001=TJ001 AND TI002=TJ002 
WHERE TI003<='20161231' AND TJ021='Y' 
AND TJ013+TJ014+TJ015 NOT IN (SELECT TH001+TH002+TH003 FROM PURTH ))--是否存在不核对采购

DELETE FROM PURTI WHERE TI001+TI002 NOT IN (SELECT TJ001+TJ002 FROM PURTJ)

---验退件退回信息档

SELECT * FROM PURTK WHERE TK002+TK003+TK004 NOT IN (SELECT TH001+TH002+TH003 FROM PURTH)--来源进货



SELECT * FROM PURTK WHERE TK002+TK003+TK004 NOT IN (SELECT CD001+CD002+CD003 FROM PURCD)--来源到货

---品号供应商每月统计维护档

DELETE FROM PURLB WHERE LB003<='201612'

---供应商每月统计维护档

DELETE FROM PURLC WHERE LC002<='201612'

----是否还有询价单？


