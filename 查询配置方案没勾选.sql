SELECT TR001,MB002,MB003,TR002,TR004,TR009,TR013,TR015,TR016
FROM COPTR
INNER JOIN INVMB ON MB001=TR001
INNER JOIN (SELECT TR001,TR002,TR004,TR013
FROM COPTR
GROUP BY TR001,TR002,TR004,TR013
HAVING COUNT(*)=2)  AS D ON D.
GROUP BY TR001,MB002,MB003,TR002,TR004,TR009,TR013,TR015,TR016
HAVING COUNT(*)>=2

--查询选配件没有勾选
SELECT TR001,TR002,TR003,TR004,TR009,TR017 FROM COPTR
WHERE 1=1
AND TR001='10910113 ' AND TR002='CI黑 8003铝脚'
AND TR004 LIKE '2400%'
--AND TR004='24004600'

SELECT TR001,TR002,TR004,TR017 FROM COPTR
WHERE 1=1
AND TR001='10910113 ' AND TR002='CI黑 8003铝脚'
AND TR004 LIKE '24%'
--AND TR004='24004600'
--AND TR009 LIKE '25%'
--AND TR017='Y'
GROUP BY TR001,TR002,TR004,TR017
HAVING COUNT(TR017)<>'1'
ORDER BY TR001,TR002

--查询选配件是任意件
SELECT CA003,CA013,MB002,MB019 FROM BOMCA 
INNER JOIN INVMB ON MB001=CA003 WHERE CA003 LIKE '24%' and CA013='4' AND MB002 LIKE '%客户%'


SELECT TR001, TR002, TR004, SUM(X001) SUMA, SUMB FROM 
(
SELECT TR001, TR002, TR004, TR017, COUNT(TR017) X001 FROM COPTR
WHERE 1=1
--AND TR001='10910113 ' AND TR002='SP浅灰 CM8003铝脚 100S'
GROUP BY TR001, TR002, TR004, TR017
) A

INNER JOIN
(
SELECT CB001, COUNT(CB005) SUMB FROM BOMCB
WHERE 1=1
GROUP BY CB001
) B ON CB001 = TR004

WHERE 1=1
AND TR004 LIKE '24%'

GROUP BY TR001, TR002, TR004, SUMB

HAVING SUM(X001) <> SUMB AND SUM(X001) % SUMB <> 0
ORDER BY TR001, TR002

