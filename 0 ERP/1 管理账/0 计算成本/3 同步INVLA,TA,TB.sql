
--修改INVLA和INVTB/INVTA表进行同步【月底成本计价前检查】
SELECT TB001,TB002,TB003,TB009,TB010,TB011,LA011,LA012,LA013
FROM INVTB
INNER JOIN INVLA ON LA006=TB001 AND LA007=TB002 AND LA008=TB003
WHERE SUBSTRING(LA004,1,6)='201907' AND LA006 LIKE '11%' AND TB011<>LA013 

UPDATE INVTB
SET TB010=LA012
FROM INVTB
INNER JOIN INVLA ON LA006=TB001 AND LA007=TB002 AND LA008=TB003
WHERE SUBSTRING(LA004,1,6)='201907' AND LA006 LIKE '11%' AND TB011<>LA013 

UPDATE INVTB
SET TB011=LA013
FROM INVTB
INNER JOIN INVLA ON LA006=TB001 AND LA007=TB002 AND LA008=TB003
WHERE SUBSTRING(LA004,1,6)='201907' AND LA006 LIKE '11%' AND TB011<>LA013

UPDATE A
SET A.TA012=B.TB011B
FROM INVTA A
INNER JOIN (SELECT TB001,TB002,SUM(TB011) AS TB011B
             FROM INVTB 
             GROUP BY TB001,TB002) AS B ON A.TA001=B.TB001 AND A.TA002=B.TB002
WHERE A.TA001 LIKE '11%' AND SUBSTRING(A.TA003,1,6)='201907'
