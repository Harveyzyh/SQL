

SELECT DISTINCT C.*, 
MB109 核准状况, MC002 品号单身仓库,  
ML002 批号仓库, ME002 批号, ME007 批号结束
FROM ATEST.dbo.CHECK2 AS C
LEFT JOIN 
(
SELECT MB001, MB109, MC002 FROM INVMB INNER JOIN INVMC ON MB001 = MC001
) AS A ON MB001 = WLNO AND MC002 = C.CK
LEFT JOIN
(
SELECT ME001, ME002, ML002, ME007 FROM INVME INNER JOIN INVML ON ML001=ME001 AND ML004 = ME002
) AS B ON ME001 = WLNO AND ME002 = PH AND ML002 = CK
WHERE 1=1
AND (ME001 IS NULL OR MB109 = 'N' OR ME007 != 'N')
-- AND ME001 IS NULL  -- 没有对应批号
-- AND MB109 = 'N'  -- 不准交易

ORDER BY 序号


-- 检查重复
SELECT WLNO, CK, PH FROM ATEST..CHECK2
GROUP BY WLNO, CK, PH HAVING COUNT(* ) >1


-- MC中不存在主仓库的项
SELECT MB001, MB017, MC002 
FROM ATEST..CHECK2
INNER JOIN INVMB ON MB001 = WLNO
LEFT JOIN INVMC ON MC001 = MB001 AND MC002 = MB017
WHERE 1=1
-- AND 底稿序号 >= '00501' 
AND MC002 IS NULL


-- 写入到99的表
-- INSERT INTO [192.168.0.99].COMFORT.dbo.INVTC
SELECT * FROM INVTC WHERE TC001 = '201907-6'


SELECT * FROM [192.168.0.99].COMFORT.dbo.INVTC WHERE TC001 = '201907-6'



SELECT * 
FROM INVTE WHERE TE001 = '201907-6'

-- 导入时数量有差异，重刷数量
SELECT TC002, TC003, TC004, TC007, TC008, WLNO, XH, CK, PH, SL 
-- UPDATE INVTC SET TC008 = SL
FROM [192.168.0.99].COMFORT.dbo.INVTC 
LEFT JOIN ATEST..AAAA ON WLNO = TC003 AND TC002 = XH AND CK = TC004 AND PH = TC007 
WHERE TC001 = '201907-6'
AND TC008 != SL
ORDER BY TC002



