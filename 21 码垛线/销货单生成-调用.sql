
-- UPDATE PdData SET PrintId = -1 WHERE PrintId NOT IN ( -1, -2) AND PrintId IS NOT NULL 

-- EXEC ROBOT_TEST.dbo.COPTG_CREATE_WORK_ZYH -- 生成销货单——执行

-- 查找可打印的销货单
SELECT TOP 1 TG001, TG002, PrintId, MD_No, PrintType FROM ROBOT_TEST.dbo.PrintData
INNER JOIN ROBOT_TEST.dbo.SplitTypeCode ON TG001 = OutType
WHERE STATUSS = 0 AND OutFlag = 1 AND PrintFlag = 0 AND PrintingFlag = 0
ORDER BY Create_Date

-- 打印列表显示
-- CREATE VIEW dbo.VPrintList AS 
SELECT * FROM (
SELECT DISTINCT PrintId 打印序号, Create_Date 创建时间, MD_No 栈板号, Num 箱数, OutFlag 已生成销货单, OutDate 销货单生成时间, 
PrintingFlag 正在打印, PrintFlag 已打印, PrintDate 打印时间, TG001 销货单别, TG002 销货单号, OutTypeName 销货单据名称, PrintData.Remark 备注, STATUSS 异常
FROM ROBOT_TEST.dbo.PrintData 
LEFT JOIN ROBOT_TEST.dbo.SplitTypeCode ON OutType = TG001
WHERE CONVERT(VARCHAR(20), Create_Date, 112) = CONVERT(VARCHAR(20), GETDATE(), 112) ) AS A0
-- ORDER BY PrintId


-- 销货单明细显示
DECLARE @TG001 VARCHAR(20), @TG002 VARCHAR(30)
SET @TG001 = '2303'
SET @TG002 = '19120524'

SELECT COPTH.TH003 AS 序号, RTRIM(COPTH.TH004) AS 品号, RTRIM(COPTH.TH005) AS 品名, RTRIM(COPTH.TH006) AS 规格,
RTRIM(COPTH.TH014) + '-' + RTRIM(COPTH.TH015) + '-' + RTRIM(COPTH.TH016) AS 生产单号, 
CONVERT(VARCHAR(10), CONVERT(FLOAT, COPTH.TH008)) AS 数量, RTRIM(COPTH.TH009) AS 单位, 
RTRIM(COPTH.UDF03) AS 描述备注, RTRIM(COPTH.UDF04) AS 保友品名, RTRIM(COPTH.UDF05) AS 配置方案, RTRIM(COPTH.UDF10) AS 产品电商代码, 
' ' + RTRIM(CMSMC.MC002) + CHAR(10)+ CHAR(10) + RTRIM(COPTH.TH004) AS 备注, RTRIM(COPTH.UDF01) AS PO号

FROM [192.168.0.99].COMFORT.dbo.COPTH
INNER JOIN [192.168.0.99].COMFORT.dbo.COPTG ON TG001 = TH001 AND TG002 = TH002
LEFT JOIN [192.168.0.99].COMFORT.dbo.COPMA ON COPMA.MA001 = COPTG.TG004 
LEFT JOIN [192.168.0.99].COMFORT.dbo.CMSMC ON COPTH.TH007 = CMSMC.MC001
LEFT JOIN [192.168.0.99].COMFORT.dbo.CMSMV ON COPTG.CREATOR = CMSMV.MV001 
WHERE RTRIM(TH001) =@TG001 AND RTRIM(TH002) = @TG002
ORDER BY COPTH.TH003





