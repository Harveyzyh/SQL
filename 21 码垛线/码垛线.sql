SELECT SC.SC001 订单号, SC003 生产日期, SC010 品名, SC013 数量, SC036 纸箱编码, 
SC037 订单编码, PO_Class+'-'+PO_Type 订单类别, MD_No 栈板号, ISNULL(PDCOUNT, 0) 已过机数量, 
(CASE SC033 WHEN '1' THEN 'Y' ELSE 'N'END ) 已完成, PD2.MIXDATE 最早过机时间, PD2.MAXDATE 最迟过机时间 
-- UPDATE SCHEDULE SET SCHEDULE.SC033 = 0 
FROM SCHEDULE AS SC 
LEFT JOIN SplitTypeCode ON TypeCode = SC037 
LEFT JOIN 
(
	SELECT SC001, MD_No, COUNT(Pd_Sta) PDCOUNT FROM PdData 
	WHERE Pd_Sta = 'OK' GROUP BY SC001, MD_No 
) AS PD ON PD.SC001 = SC.SC001 
LEFT JOIN 
(
	SELECT SC001, MIN(Pd_date) MIXDATE, MAX(Pd_date) MAXDATE FROM PdData 
	WHERE Pd_Sta = 'OK' GROUP BY SC001 
) AS PD2 ON PD2.SC001 = SC.SC001 
WHERE 1=1
-- AND SC003 = CONVERT(VARCHAR(20), GETDATE(), 112) -- AND SC039 != 'Y'
AND SC.SC001 IN ('2210-0000003-0001') 
-- AND SC039 = 'Y'
ORDER BY KEY_ID 


SELECT * 
--DELETE
FROM PdData
WHERE SC001 = '2210-0000003-0001'

SELECT SC001, SC002, SC003, SC013, SC036, SC037, SC038, SC039 
-- UPDATE SCHEDULE SET SC038 = 'N'
-- UPDATE SCHEDULE SET SC039 = 'Y' , SC003 = CONVERT(VARCHAR(20), GETDATE(), 112)
FROM SCHEDULE 
WHERE 1=1
--AND SC039 != 'Y'
AND SC001 = '2210-0000003-0001'
-- AND SC036 = 'NULL'
-- AND SC003 = CONVERT(VARCHAR(20), GETDATE(), 112)