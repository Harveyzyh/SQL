SELECT RTRIM(MB001) AS 材料品号, RTRIM(MB002) AS 品名, RTRIM(MB003) AS 规格, 
CAST(SUM(TB004) AS FLOAT) AS 需领料量, CAST(SUM(TB005) AS FLOAT) AS 已领料量, 
CAST(SUM(TB004 - TB005) AS FLOAT) AS 未领料量, RTRIM(MC002) 仓库, CAST(MC007 AS FLOAT) 现有库存量
FROM COMFORT..COPTC
INNER JOIN COMFORT..COPTD ON TC001 = TD001 AND TC002 = TD002 AND TD016 NOT IN ('Y', 'y')
INNER JOIN COMFORT..MOCTA ON TA026 = TD001 AND TA027 = TD002 AND TA028 = TD003 AND TA011 NOT IN ('Y', 'y')
INNER JOIN COMFORT..MOCTB ON TB001 = TA001 AND TB002 = TA002
INNER JOIN COMFORT..INVMB ON TA001 = TB001 AND TA002 = TB002
INNER JOIN COMFORT..INVMC ON MC001 = MB001 AND MC002 = 'P013'
WHERE 1=1
AND RTRIM(TD001) + '-' + RTRIM(TD002) + '-' + RTRIM(TD003) IN ('') 
GROUP BY RTRIM(MB001), RTRIM(MB002), RTRIM(MB003), RTRIM(MC002), CAST(MC007 AS FLOAT)
ORDER BY RTRIM(MB001)



SELECT RTRIM(TD001) + '-' + RTRIM(TD002) + '-' + RTRIM(TD003) AS 订单号, RTRIM(MB001) AS 成品品号, RTRIM(MB002) AS 成品品名, RTRIM(MB003) AS 成品规格, 
CAST(TD008 AS FLOAT) AS 订单数量, CAST((TD008 - TD009) AS FLOAT) AS 未交数量, 
CAST(TD024 AS FLOAT) AS 赠品数量, CAST((TD024 - TD025) AS FLOAT) AS 赠品未交数,
TD013 AS 预交货日期, (CASE TD016 WHEN 'Y' THEN '自动完成' WHEN 'N' THEN '未完成' WHEN 'y' THEN '指定结束' ELSE TD016 END) AS 订单状态, 
RTRIM(TC004) AS 客户编号, RTRIM(MA002) AS 客户名称
FROM COMFORT..COPTC 
INNER JOIN COMFORT..COPTD ON TC001 = TD001 AND TC002 = TD002
INNER JOIN COMFORT..INVMB ON MB001 = TD004
INNER JOIN COMFORT..COPMA ON MA001 = TC004
WHERE 1=1
AND TC027 = 'Y'
AND (RTRIM(TD001) + '-' + RTRIM(TD002) + '-' + RTRIM(TD003) LIKE '%{}%' OR )
