
------MOC工单委外子系统-------

---工单
SELECT * FROM MOCTA WHERE TA040<='20161231' AND (TA011='Y' OR TA011='y') AND (TA014<='20161231' OR TA014='')

DELETE FROM MOCTA WHERE TA040<='20161231' AND (TA011='Y' OR TA011='y') AND (TA014<='20161231' OR TA014='')

DELETE FROM MOCTB WHERE TB001+TB002 NOT IN (SELECT TA001+TA002 FROM MOCTA) 

---------------------------------------------------------------------------------------------------------

---领退料单

SELECT * FROM MOCTE 
LEFT JOIN MOCTC ON TE001=TC001 AND TE002=TC002 
WHERE TE011+TE012 NOT IN (SELECT TA001+TA002 FROM MOCTA)
AND  TC003<='20161231' AND TC011='Y'

DELETE FROM MOCTE WHERE TE001+TE002+TE003 IN 
(SELECT TE001+TE002+TE003 FROM MOCTE 
LEFT JOIN MOCTC ON TE001=TC001 AND TE002=TC002 
WHERE TE011+TE012 NOT IN (SELECT TA001+TA002 FROM MOCTA)
AND  TC003<='20161231' AND TC011='Y')

DELETE FROM MOCTC WHERE TC001+TC002 NOT IN (SELECT TE001+TE002 FROM MOCTE) 

DELETE FROM MOCTD WHERE TD001+TD002 NOT IN (SELECT TC001+TC002 FROM MOCTC)

 
-----------------------------------------------------------------------------------------------

---生产入库

DELETE FROM MOCTG WHERE TG014+TG015 NOT IN (SELECT TA001+TA002 FROM MOCTA)

DELETE FROM MOCTF WHERE TF001+TF002 NOT IN (SELECT TG001+TG002 FROM MOCTG)


------------------------------------------------------------------------------------------

----------------------------委外进货--------------注意是否开票:TI038-----------


SELECT *  FROM MOCTI WHERE TI038<>'N' AND TI013+TI014 NOT IN (SELECT TA001+TA002 FROM MOCTA) AND TI020=TI052--计价数量=开票数量

DELETE FROM MOCTI WHERE TI038<>'N' AND TI013+TI014 NOT IN (SELECT TA001+TA002 FROM MOCTA) AND TI020=TI052--计价数量=开票数量

DELETE FROM MOCTH WHERE TH001+TH002 NOT IN (SELECT TI001+TI002 FROM MOCTI)

DELETE FROM MOCTJ WHERE TJ002+TJ003 NOT IN (SELECT TH001+TH002 FROM MOCTH)----委外验退件退回信息档

---SELECT * FROM MOCTH WHERE TH003<='20141231' AND TH023<>'Y'


-------------------------------------------------------------------------------------------



---委外退货----------注意是否开票:TL025--------------


SELECT * FROM MOCTL WHERE TL025<>'N' AND TL026+TL027+TL028 NOT IN (SELECT TI001+TI002+TI003 FROM MOCTI) AND TL009=TL035

DELETE FROM MOCTL WHERE TL025<>'N' AND TL026+TL027+TL028 NOT IN (SELECT TI001+TI002+TI003 FROM MOCTI)
 AND TL009=TL035--计价=开票

DELETE FROM MOCTK WHERE TK001+TK002 NOT IN (SELECT TL001+TL002 FROM MOCTL)


------------------------------------------------------------------------------------
---工单变更

SELECT * FROM MOCTO WHERE TO001+TO002 NOT IN (SELECT TA001+TA002 FROM MOCTA)

DELETE  FROM MOCTO WHERE TO001+TO002 NOT IN (SELECT TA001+TA002 FROM MOCTA)

DELETE FROM MOCTP WHERE TP001+TP002 NOT IN (SELECT TO001+TO002 FROM MOCTO)


